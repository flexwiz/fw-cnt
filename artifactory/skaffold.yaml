apiVersion: skaffold/v4beta5
kind: Config
metadata:
  name: artifactory
profiles:
  - name: dev
    activation:
      - kubeContext: minikube
    deploy: &artifactory_deploy
      helm:
        releases:
          - name: artifactory
            # https://artifacthub.io/packages/helm/jfrog/artifactory
            repo: https://charts.jfrog.io/jfrog/artifactory
            remoteChart: jfrog/artifactory
            version: 107.98.7
            namespace: artifactory
            setValues:
              admin.username: admin
              admin.password: admin
    portForward: &artifactory_port_forward
      - resourceType: service
        resourceName: artifactory
        port: 8082
        localPort: 8082

  - name: dev-gcp
    deploy: *artifactory_deploy
    portForward: *artifactory_port_forward
    build:
      googleCloudBuild:
        projectId: "ntdt-dev"
        concurrency: 0
    activation:
      - kubeContext: gke_ntdt-dev_europe-west1-b_ntdt-dev-k8s-cluster
