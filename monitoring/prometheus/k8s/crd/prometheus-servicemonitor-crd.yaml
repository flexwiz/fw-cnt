apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: servicemonitors.monitoring.coreos.com
  labels:
    app.kubernetes.io/name: prometheus-operator
    app.kubernetes.io/part-of: istio-monitoring
spec:
  group: monitoring.coreos.com
  names:
    kind: ServiceMonitor
    listKind: ServiceMonitorList
    plural: servicemonitors
    singular: servicemonitor
    shortNames:
      - smon
    categories:
      - prometheus-operator
  scope: Namespaced
  versions:
    - name: v1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          required:
            - spec
          properties:
            spec:
              type: object
              required:
                - selector
                - endpoints
              properties:
                jobLabel:
                  description: The label to use to retrieve the job name from.
                  type: string
                targetLabels:
                  description: TargetLabels transfers labels on the Kubernetes Service onto the target.
                  type: array
                  items:
                    type: string
                podTargetLabels:
                  description: PodTargetLabels transfers labels on the Kubernetes Pod onto the target.
                  type: array
                  items:
                    type: string
                selector:
                  description: Selector to select Endpoints objects.
                  type: object
                  properties:
                    matchExpressions:
                      type: array
                      items:
                        type: object
                        required:
                          - key
                          - operator
                        properties:
                          key:
                            type: string
                          operator:
                            type: string
                          values:
                            type: array
                            items:
                              type: string
                    matchLabels:
                      type: object
                      additionalProperties:
                        type: string
                namespaceSelector:
                  description: Selector to select which namespaces the Endpoints objects are discovered from.
                  type: object
                  properties:
                    any:
                      description: Match any namespace
                      type: boolean
                    matchNames:
                      description: Match specific namespaces by name
                      type: array
                      items:
                        type: string
                endpoints:
                  description: Endpoints defines a list of metrics scraping endpoints for the ServiceMonitor
                  type: array
                  items:
                    type: object
                    required:
                      - port
                    properties:
                      port:
                        description: Port name or number used for scraping
                        oneOf:
                          - type: string
                          - type: integer
                      path:
                        description: Path to scrape metrics from
                        type: string
                      scheme:
                        description: Protocol scheme used for scraping (HTTP or HTTPS)
                        type: string
                        enum:
                          - HTTP
                          - HTTPS
                      interval:
                        description: Interval at which metrics should be scraped
                        type: string
                        pattern: ^(([0-9]+)y)?(([0-9]+)w)?(([0-9]+)d)?(([0-9]+)h)?(([0-9]+)m)?(([0-9]+)s)?(([0-9]+)ms)?$
                      scrapeTimeout:
                        description: Timeout after which the scrape is ended
                        type: string
                        pattern: ^(([0-9]+)y)?(([0-9]+)w)?(([0-9]+)d)?(([0-9]+)h)?(([0-9]+)m)?(([0-9]+)s)?(([0-9]+)ms)?$
                      tlsConfig:
                        description: TLS configuration to use when scraping the endpoint
                        type: object
                        properties:
                          caFile:
                            description: Path to the CA file
                            type: string
                          certFile:
                            description: Path to the client cert file
                            type: string
                          keyFile:
                            description: Path to the client key file
                            type: string
                          serverName:
                            description: ServerName extension to indicate the name of the server
                            type: string
                          insecureSkipVerify:
                            description: Disable target certificate validation
                            type: boolean
                      bearerTokenFile:
                        description: File to read bearer token for scraping targets
                        type: string
                      bearerTokenSecret:
                        description: Secret to mount to read bearer token
                        type: object
                        required:
                          - name
                        properties:
                          name:
                            type: string
                          key:
                            type: string
                      honorLabels:
                        description: Honor labels already present in scraped data
                        type: boolean
                      honorTimestamps:
                        description: Honor timestamps in scraped data
                        type: boolean
                      basicAuth:
                        description: Basic authentication to use when scraping
                        type: object
                        properties:
                          username:
                            description: SecretKeySelector to select the username
                            type: object
                            required:
                              - name
                            properties:
                              name:
                                type: string
                              key:
                                type: string
                          password:
                            description: SecretKeySelector to select the password
                            type: object
                            required:
                              - name
                            properties:
                              name:
                                type: string
                              key:
                                type: string
                      metricRelabelings:
                        description: MetricRelabelConfigs to apply to samples before ingestion
                        type: array
                        items:
                          type: object
                          properties:
                            sourceLabels:
                              description: The source labels select values from existing labels
                              type: array
                              items:
                                type: string
                            separator:
                              description: Separator placed between concatenated source label values
                              type: string
                            targetLabel:
                              description: Label to which the resulting value is written
                              type: string
                            regex:
                              description: Regular expression against which the extracted value is matched
                              type: string
                            modulus:
                              description: Modulus to take of the hash of the source label values
                              type: integer
                            replacement:
                              description: Replacement value against which a regex replace is performed
                              type: string
                            action:
                              description: Action to perform based on regex matching
                              type: string
                              enum:
                                - replace
                                - keep
                                - drop
                                - hashmod
                                - labelmap
                                - labeldrop
                                - labelkeep
                      relabelings:
                        description: RelabelConfigs to apply to samples before scraping
                        type: array
                        items:
                          type: object
                          properties:
                            sourceLabels:
                              description: The source labels select values from existing labels
                              type: array
                              items:
                                type: string
                            separator:
                              description: Separator placed between concatenated source label values
                              type: string
                            targetLabel:
                              description: Label to which the resulting value is written
                              type: string
                            regex:
                              description: Regular expression against which the extracted value is matched
                              type: string
                            modulus:
                              description: Modulus to take of the hash of the source label values
                              type: integer
                            replacement:
                              description: Replacement value against which a regex replace is performed
                              type: string
                            action:
                              description: Action to perform based on regex matching
                              type: string
                              enum:
                                - replace
                                - keep
                                - drop
                                - hashmod
                                - labelmap
                                - labeldrop
                                - labelkeep
                      proxyUrl:
                        description: ProxyURL to scrape through
                        type: string
                sample:
                  type: object
                  description: SampleLimit defines per-scrape limit on number of scraped samples
                  properties:
                    limit:
                      type: integer
                targetLimit:
                  type: integer
                  description: TargetLimit defines a limit on the number of scraped targets
      additionalPrinterColumns:
      - name: Age
        type: date
        jsonPath: .metadata.creationTimestamp
