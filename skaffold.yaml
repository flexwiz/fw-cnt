apiVersion: skaffold/v4beta5
kind: Config
metadata:
  name: common-tools

requires:
  - configs: ["artifactory"]
    path: ./artifactory
    activeProfiles: &local_and_cloud_profiles
      - name: dev
        activatedBy: [dev]
      - name: dev-gcp
        activatedBy: [dev-gcp]
  - configs: ["keycloak"]
    path: ./keycloak
    activeProfiles: *local_and_cloud_profiles
  - configs: ["minio"]
    path: ./minio
    activeProfiles: *local_and_cloud_profiles
  - configs: ["mongodb"]
    path: ./mongodb
    activeProfiles: *local_and_cloud_profiles
  - configs: ["postgres"]
    path: ./postgres
    activeProfiles: *local_and_cloud_profiles
  - configs: ["redis"]
    path: ./redis
    activeProfiles: *local_and_cloud_profiles
  - configs: ["sftp"]
    path: ./sftp
    activeProfiles: *local_and_cloud_profiles
  - configs: ["superset"]
    path: ./superset
    activeProfiles: *local_and_cloud_profiles

profiles:
  - name: dev
    build:
      local:
        concurrency: 0
        useBuildkit: true
    activation:
      - kubeContext: minikube
  - name: dev-gcp
    build:
      googleCloudBuild:
        workerPool: projects/ntdt-dev/locations/europe-west1/workerPools/worker-dev-pool
        projectId: ntdt-dev
        concurrency: 0
    activation:
      - kubeContext: gke_ntdt-dev_europe-west1-b_ntdt-dev-k8s-cluster